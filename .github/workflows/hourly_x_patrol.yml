name: Hourly X Patrol (Grok 4.1 Fast)

on:
  schedule:
    # Run every hour
    - cron: '0 * * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  hourly-patrol:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        pip install requests python-dotenv tweepy

    - name: Run Hourly X Patrol
      env:
        XAI_API_KEY: ${{ secrets.XAI_API_KEY }}
        # X API for posting if built-in
        X_CONSUMER_KEY: ${{ secrets.X_CONSUMER_KEY }}
        X_CONSUMER_SECRET: ${{ secrets.X_CONSUMER_SECRET }}
        X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
        X_ACCESS_TOKEN_SECRET: ${{ secrets.X_ACCESS_TOKEN_SECRET }}
      run: |
        # 1. Collect from X (Agent)
        python collect_ai_news.py
        
        # 2. Post Breaking News (if any)
        # Note: post_to_x.py checks for "new" reports from collect_ai_news.py
        python post_to_x.py

    - name: Build Website (Hourly Update)
      run: |
        python build_site.py

    - name: Commit and Push changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "Hourly X Patrol Update [skip ci]"
        branch: main
